<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Make a Wish ‚Ä¢ Nithya</title>
   
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
   
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Great+Vibes&family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;500;600&display=swap" rel="stylesheet">
   
    <style>
        :root {
            --rose: #e8b4b8;
            --gold: #d4af37;
        }
        body {
            margin: 0;
            overflow: hidden;
            background: #0a030f;
            color: white;
            font-family: 'Montserrat', sans-serif;
            user-select: none;
            touch-action: none;
        }
        #cake-container {
            position: absolute;
            inset: 0;
            z-index: 10;
            cursor: none;
        }
        .bg-particles {
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(circle at 30% 20%, rgba(232,180,184,0.12) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(212,175,55,0.08) 0%, transparent 60%);
            animation: twinkle 10s infinite alternate ease-in-out;
        }
        @keyframes twinkle { 0% { opacity: 0.7; } 100% { opacity: 1.1; } }

        .ui-layer {
            position: absolute;
            inset: 0;
            z-index: 30;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 2rem;
        }
        .title h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(3rem, 9vw, 6rem);
            color: #e8b4b8;
            text-shadow: 0 0 50px rgba(232,180,184,0.7);
            letter-spacing: -0.03em;
        }
        .instruction-pill {
            position: absolute;
            bottom: 8%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10,3,15,0.8);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(232,180,184,0.5);
            padding: 16px 48px;
            border-radius: 9999px;
            font-family: 'Cinzel', serif;
            color: #e8b4b8;
            font-size: 1.05rem;
            letter-spacing: 0.18em;
            box-shadow: 0 0 50px rgba(232,180,184,0.4);
            pointer-events: none;
        }
        .hand-icon {
            display: inline-block;
            animation: sliceHint 1.6s infinite ease-in-out;
        }
        @keyframes sliceHint {
            0%, 100% { transform: translateX(-10px) rotate(-15deg); }
            50% { transform: translateX(15px) rotate(15deg); }
        }
        .celebration-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            text-align: center;
            z-index: 50;
            pointer-events: none;
        }
        .bday-msg {
            font-family: 'Great Vibes', cursive;
            font-size: clamp(5rem, 16vw, 11rem);
            line-height: 0.85;
            background: linear-gradient(180deg, #fff, #e8b4b8, #ffd700);
            -webkit-background-clip: text;
            color: transparent;
            text-shadow: 0 0 80px rgba(232,180,184,0.9);
        }
        .bday-name {
            font-family: 'Cinzel', serif;
            font-size: clamp(2rem, 7vw, 4rem);
            letter-spacing: 0.8em;
            color: #ffd700;
            margin-top: -15px;
        }
        .back-btn {
            position: fixed;
            top: 30px;
            left: 30px;
            z-index: 100;
            padding: 12px 28px;
            border: 1px solid rgba(232,180,184,0.5);
            border-radius: 9999px;
            color: #e8b4b8;
            font-size: 0.85rem;
            letter-spacing: 0.2em;
            transition: all 0.4s cubic-bezier(0.23,1,0.32,1);
        }
        .back-btn:hover {
            background: #e8b4b8;
            color: #0a030f;
            transform: scale(1.05);
        }
        #knife-cursor {
            position: absolute;
            width: 52px;
            height: 130px;
            pointer-events: none;
            z-index: 999;
            opacity: 0;
            transition: transform 0.04s linear;
            filter: drop-shadow(0 0 12px #e8b4b8);
        }
    </style>
</head>
<body>
    <audio id="slice-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/2754/2754-preview.mp3" type="audio/mp3">
    </audio>
    <audio id="bday-audio" preload="auto">
        <source src="media/happy_birthday.mp3" type="audio/mp3">
    </audio>

    <a href="index.html" class="back-btn font-cinematic">‚Üê RETURN</a>

    <div class="bg-particles"></div>
   
    <div class="ui-layer">
        <div class="title text-center w-full mt-8">
            <h1 class="opacity-0">Make a Wish, Nithya</h1>
        </div>
       
        <div class="instruction-pill flex items-center gap-3 text-center" id="hint-text">
            DRAG TO CUT THE CAKE <span class="hand-icon text-3xl">üî™</span>
        </div>
    </div>

    <div class="celebration-text" id="celebration">
        <h1 class="bday-msg">Happy Birthday</h1>
        <p class="bday-name">NITHYA ‚ú®</p>
    </div>

    <div id="cake-container"></div>
    <img id="knife-cursor" src="https://i.ibb.co/8XvY0vZ/knife-cursor.png" alt="knife">

    <script>
        // ====================== THREE.JS ULTRA PREMIUM SCENE ======================
        const container = document.getElementById('cake-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x0a030f, 0.022);

        const camera = new THREE.PerspectiveCamera(46, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 6, 13);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        // ====================== ROMANTIC LIGHTING ======================
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));

        const mainLight = new THREE.SpotLight(0xfff0d0, 4.2, 0, Math.PI/3.2, 0.35);
        mainLight.position.set(10, 20, 12);
        mainLight.castShadow = true;
        mainLight.shadow.mapSize.width = 2048;
        mainLight.shadow.mapSize.height = 2048;
        scene.add(mainLight);

        const rimLight = new THREE.DirectionalLight(0xe8b4b8, 1.8);
        rimLight.position.set(-12, 8, -15);
        scene.add(rimLight);

        const candleLights = [];

        // ====================== LUXURY CAKE (now with roses, pearls & topper) ======================
        const cake = new THREE.Group();
        scene.add(cake);

        const cakeMat = new THREE.MeshPhongMaterial({ color: 0xf8d7e3, shininess: 18, specular: 0xffffff });
        const chocolateMat = new THREE.MeshPhongMaterial({ color: 0x3a2a25, shininess: 12 });
        const goldMat = new THREE.MeshPhongMaterial({ color: 0xd4af37, shininess: 95, specular: 0xffffff, metalness: 0.95 });

        // Tiers
        const tier1 = new THREE.Mesh(new THREE.CylinderGeometry(3.8, 3.95, 1.7, 128), cakeMat);
        tier1.castShadow = true; tier1.receiveShadow = true;
        cake.add(tier1);

        const tier2 = new THREE.Mesh(new THREE.CylinderGeometry(2.85, 2.95, 1.35, 128), chocolateMat);
        tier2.position.y = 1.52;
        cake.add(tier2);

        const tier3 = new THREE.Mesh(new THREE.CylinderGeometry(2.05, 2.15, 1.15, 128), cakeMat);
        tier3.position.y = 2.72;
        cake.add(tier3);

        const tier4 = new THREE.Mesh(new THREE.CylinderGeometry(1.35, 1.45, 0.95, 128), chocolateMat);
        tier4.position.y = 3.72;
        cake.add(tier4);

        // Gold drips + pearls
        for (let i = 0; i < 9; i++) {
            const drip = new THREE.Mesh(new THREE.TorusGeometry(2.92 + i*0.06, 0.09, 18, 64), goldMat);
            drip.rotation.x = Math.PI / 2;
            drip.position.y = 1.48 + Math.random() * 0.7;
            drip.rotation.z = Math.random() * Math.PI * 2;
            cake.add(drip);
        }
        for (let i = 0; i < 28; i++) {
            const pearl = new THREE.Mesh(new THREE.SphereGeometry(0.09, 16, 16), new THREE.MeshPhongMaterial({ color: 0xffffff, shininess: 100 }));
            pearl.position.set((Math.random()-0.5)*7.2, 0.85 + Math.random()*3.6, (Math.random()-0.5)*7.2);
            cake.add(pearl);
        }

        // Decorative roses on cake
        function createRose() {
            const rose = new THREE.Group();
            const petalMat = new THREE.MeshPhongMaterial({ color: 0xff69b4, shininess: 10 });
            for (let i = 0; i < 8; i++) {
                const petal = new THREE.Mesh(new THREE.SphereGeometry(0.18, 12, 12), petalMat);
                petal.scale.set(0.6, 0.25, 1);
                petal.rotation.set(Math.random()*0.6, i * 0.8, 0);
                rose.add(petal);
            }
            return rose;
        }
        for (let i = 0; i < 7; i++) {
            const rose = createRose();
            rose.position.set((Math.random()-0.5)*6, 0.9 + Math.random()*3, (Math.random()-0.5)*6);
            rose.rotation.y = Math.random() * Math.PI;
            rose.scale.set(0.7, 0.7, 0.7);
            cake.add(rose);
        }

        // Sprinkles
        const sprinkleMat = new THREE.MeshPhongMaterial({ color: 0xff69b4 });
        for (let i = 0; i < 220; i++) {
            const sprinkle = new THREE.Mesh(new THREE.CylinderGeometry(0.035, 0.035, 0.22, 8), sprinkleMat);
            sprinkle.position.set((Math.random()-0.5)*7.5, 0.85 + Math.random()*3.6, (Math.random()-0.5)*7.5);
            sprinkle.rotation.set(Math.random()*Math.PI, Math.random()*Math.PI, Math.random()*Math.PI);
            cake.add(sprinkle);
        }

        // 9 candles + topper plate
        const candles = [];
        const plate = new THREE.Mesh(new THREE.CylinderGeometry(1.6, 1.6, 0.12, 64), goldMat);
        plate.position.y = 4.45;
        cake.add(plate);

        for (let i = 0; i < 9; i++) {
            const candle = new THREE.Mesh(new THREE.CylinderGeometry(0.11, 0.11, 1.35, 24), new THREE.MeshPhongMaterial({ color: 0xfff8e1 }));
            const angle = (i / 9) * Math.PI * 2 + 0.3;
            candle.position.set(Math.cos(angle) * 1.05, 4.55, Math.sin(angle) * 1.05);
            cake.add(candle);
            candles.push(candle);

            const light = new THREE.PointLight(0xffaa44, 2.6, 9);
            light.position.set(candle.position.x, candle.position.y + 1.3, candle.position.z);
            scene.add(light);
            candleLights.push(light);
        }

        // Animated flames
        const flameGroup = new THREE.Group();
        cake.add(flameGroup);
        const flames = [];
        candles.forEach((c, i) => {
            const canvas = document.createElement('canvas'); canvas.width = canvas.height = 64;
            const ctx = canvas.getContext('2d');
            const tex = new THREE.CanvasTexture(canvas);
            const mat = new THREE.SpriteMaterial({ map: tex, blending: THREE.AdditiveBlending, transparent: true });
            const flame = new THREE.Sprite(mat);
            flame.scale.set(0.68, 1.05, 1);
            flame.position.copy(c.position);
            flame.position.y += 1.8;
            flameGroup.add(flame);
            flames.push({sprite: flame, ctx, tex});
        });

        function animateFlames(t) {
            flames.forEach((f, i) => {
                const ctx = f.ctx;
                ctx.clearRect(0,0,64,64);
                const g = ctx.createRadialGradient(32,30,3,32,22,31);
                g.addColorStop(0, `rgba(255,245,160,${0.95 + Math.sin(t*22 + i)*0.12})`);
                g.addColorStop(0.35, `rgba(255,130,55,${0.8 + Math.cos(t*17 + i)*0.25})`);
                g.addColorStop(1, 'rgba(255,40,10,0)');
                ctx.fillStyle = g;
                ctx.beginPath();
                ctx.ellipse(32, 30, 19, 34, Math.sin(t*9 + i)*0.25, 0, Math.PI*2);
                ctx.fill();
                f.tex.needsUpdate = true;
            });
        }

        // ====================== FLOATING ROSE PETALS & SPARKLES ======================
        const petalParticles = new THREE.Group();
        scene.add(petalParticles);
        const sparkleParticles = new THREE.Group();
        scene.add(sparkleParticles);

        for (let i = 0; i < 85; i++) {
            const petal = new THREE.Mesh(
                new THREE.PlaneGeometry(0.45, 0.65),
                new THREE.MeshPhongMaterial({ color: 0xe8b4b8, side: THREE.DoubleSide, transparent: true, opacity: 0.75 })
            );
            petal.position.set((Math.random()-0.5)*40, Math.random()*25 + 5, (Math.random()-0.5)*40);
            petal.rotation.set(Math.random()*Math.PI, Math.random()*Math.PI, Math.random()*Math.PI);
            petal.userData = { speed: 0.012 + Math.random()*0.018, rotSpeed: 0.008 + Math.random()*0.02 };
            petalParticles.add(petal);
        }

        for (let i = 0; i < 120; i++) {
            const sparkle = new THREE.Mesh(
                new THREE.SphereGeometry(0.07, 6, 6),
                new THREE.MeshPhongMaterial({ color: 0xffd700, emissive: 0xffd700, emissiveIntensity: 0.8 })
            );
            sparkle.position.set((Math.random()-0.5)*28, Math.random()*18 + 4, (Math.random()-0.5)*28);
            sparkle.userData = { speed: 0.03 + Math.random()*0.04 };
            sparkleParticles.add(sparkle);
        }

        function animateParticles(t) {
            petalParticles.children.forEach(p => {
                p.position.y -= p.userData.speed;
                p.rotation.z += p.userData.rotSpeed;
                if (p.position.y < -8) p.position.y = 28;
            });
            sparkleParticles.children.forEach((s, i) => {
                s.position.y += Math.sin(t*3 + i) * 0.018;
                s.scale.setScalar(0.9 + Math.sin(t*12 + i)*0.3);
                if (Math.random() < 0.01) s.position.y += 4;
            });
        }

        // ====================== 3D KNIFE + GLOWING TRAIL ======================
        const knife = new THREE.Group();
        scene.add(knife);

        const blade = new THREE.Mesh(
            new THREE.BoxGeometry(0.09, 3.4, 0.65),
            new THREE.MeshPhongMaterial({ color: 0xeeeeee, shininess: 110, specular: 0xffffff })
        );
        blade.rotation.x = Math.PI / 2;
        blade.position.y = 1.7;
        knife.add(blade);

        const handle = new THREE.Mesh(
            new THREE.CylinderGeometry(0.13, 0.15, 1.5, 18),
            new THREE.MeshPhongMaterial({ color: 0xe8b4b8, shininess: 40 })
        );
        handle.rotation.x = Math.PI / 2;
        handle.position.y = 0.15;
        knife.add(handle);

        // Trail line
        const trailPoints = [];
        const trailGeo = new THREE.BufferGeometry();
        const trailMat = new THREE.LineBasicMaterial({ color: 0xe8b4b8, transparent: true, opacity: 0.6 });
        const trailLine = new THREE.Line(trailGeo, trailMat);
        scene.add(trailLine);
        knife.visible = false;

        // ====================== INTERACTION + CUTTING ======================
        let isDragging = false;
        let cutProgress = 0;
        let hasCut = false;
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        const sliceSound = document.getElementById('slice-sound');
        const bdayAudio = document.getElementById('bday-audio');

        let audioPrimed = false;
        function primeAudio() {
            if (audioPrimed) return;
            bdayAudio.play().then(() => { bdayAudio.pause(); bdayAudio.currentTime = 0; audioPrimed = true; }).catch(() => {});
        }

        function onPointerDown(e) {
            primeAudio();
            if (hasCut) return;
            isDragging = true;
            knife.visible = true;
            updateKnifePosition(e);
            cutProgress = 0;
            trailPoints.length = 0;
        }

        function onPointerMove(e) {
            if (!isDragging || hasCut) return;
            updateKnifePosition(e);
            cutProgress = Math.min(cutProgress + 0.042, 1);
            knife.rotation.z = (cutProgress - 0.5) * 0.75;

            // Trail
            trailPoints.push(knife.position.clone());
            if (trailPoints.length > 12) trailPoints.shift();
            trailGeo.setFromPoints(trailPoints);

            if (Math.random() < 0.55) createCrumbs();
        }

        function updateKnifePosition(e) {
            const rect = container.getBoundingClientRect();
            mouse.x = ((e.clientX || e.touches[0].clientX) - rect.left) / rect.width * 2 - 1;
            mouse.y = -((e.clientY || e.touches[0].clientY) - rect.top) / rect.height * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const plane = new THREE.Plane(new THREE.Vector3(0, 1, 0), -1.9);
            const point = new THREE.Vector3();
            raycaster.ray.intersectPlane(plane, point);

            if (point) {
                knife.position.copy(point);
                knife.position.y = 4 + Math.sin(Date.now()/180) * 0.15;
                knife.lookAt(point.x * 1.3, 0, point.z * 1.3);
            }
        }

        function createCrumbs() {
            for (let i = 0; i < 7; i++) {
                const crumb = new THREE.Mesh(new THREE.SphereGeometry(0.08, 7, 7), new THREE.MeshPhongMaterial({ color: 0xf8d7e3 }));
                crumb.position.copy(knife.position);
                crumb.position.y -= 0.6;
                scene.add(crumb);
                gsap.to(crumb.position, { y: "-=5", x: (Math.random()-0.5)*5, z: (Math.random()-0.5)*5, duration: 1.6, ease: "power2.out", onComplete: () => scene.remove(crumb) });
            }
        }

        function onPointerUp() {
            if (!isDragging || hasCut) return;
            isDragging = false;
            trailPoints.length = 0;
            trailGeo.setFromPoints([]);

            if (cutProgress > 0.68) {
                hasCut = true;
                triggerUltraCut();
            } else {
                knife.visible = false;
            }
        }

        function triggerUltraCut() {
            sliceSound.currentTime = 0;
            sliceSound.play();

            gsap.to(knife.position, { y: 0.6, duration: 0.55, ease: "back.in(2)" });
            gsap.to(knife.rotation, { z: -1.35, duration: 0.9 });

            setTimeout(() => {
                const left = cake.clone();
                const right = cake.clone();
                scene.add(left); scene.add(right); scene.remove(cake);

                gsap.to(left.position, { x: -4.2, duration: 2.6, ease: "power4.out" });
                gsap.to(right.position, { x: 4.2, duration: 2.6, ease: "power4.out" });
                gsap.to(left.rotation, { y: -0.85, duration: 3.1 });
                gsap.to(right.rotation, { y: 0.85, duration: 3.1 });
            }, 380);

            setTimeout(launchEpicCelebration, 750);
        }

        function launchEpicCelebration() {
            bdayAudio.volume = 0.82;
            bdayAudio.play();

            gsap.to('.instruction-pill', { opacity: 0, y: 40, duration: 1.1 });
            gsap.to(knife, { visible: false });

            // Cinematic camera orbit
            gsap.to(camera.position, { z: 22, y: 9, duration: 4.2, ease: "power2.inOut" });
            gsap.to(camera.position, { x: 6, duration: 5.5, ease: "sine.inOut", yoyo: true, repeat: 1 });

            // Massive layered confetti
            const colors = ['#e8b4b8', '#d4af37', '#ff69b4', '#ffffff', '#ffd700'];
            let burstCount = 0;
            const burst = setInterval(() => {
                confetti({ particleCount: 220, spread: 110, origin: { x: Math.random(), y: 0.25 }, colors });
                burstCount++;
                if (burstCount > 26) clearInterval(burst);
            }, 110);

            // Reveal text with extra flair
            gsap.to('#celebration', { scale: 1, opacity: 1, duration: 3.1, ease: "elastic.out(1.1, 0.4)", delay: 0.7 });
        }

        // ====================== ANIMATION LOOP ======================
        let clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const t = clock.getElapsedTime();

            // Cake breathing
            cake.rotation.y = Math.sin(t * 0.28) * 0.028;
            cake.position.y = Math.sin(t * 0.75) * 0.07;

            // Lights flicker
            candleLights.forEach((l, i) => l.intensity = 2.4 + Math.sin(t * 21 + i) * 0.75);

            animateFlames(t);
            animateParticles(t);

            renderer.render(scene, camera);
        }
        animate();

        // ====================== EVENTS ======================
        container.addEventListener('mousedown', onPointerDown);
        container.addEventListener('mousemove', onPointerMove);
        container.addEventListener('mouseup', onPointerUp);
        container.addEventListener('touchstart', onPointerDown);
        container.addEventListener('touchmove', onPointerMove);
        container.addEventListener('touchend', onPointerUp);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // ====================== INTRO ======================
        gsap.to('.title h1', { opacity: 1, y: 0, duration: 2.4, delay: 0.3, ease: "power3.out" });
        gsap.to('.instruction-pill', { opacity: 1, scale: 1, duration: 2, delay: 1.9 });

        setTimeout(() => {
            document.getElementById('knife-cursor').style.opacity = '0.3';
        }, 2600);
    </script>
</body>
</html>
