<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE ARCHIVES | Sarah</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&family=Playfair+Display:ital,wght@1,400&display=swap" rel="stylesheet">

    <style>
        :root { --gold: #D4AF37; --cyan: #00f3ff; --black: #050505; }
        body { background-color: var(--black); color: white; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; width: 100vw; }
        
        /* --- SCENE MANAGEMENT --- */
        .chapter {
            position: absolute; inset: 0; width: 100%; height: 100%;
            opacity: 0; pointer-events: none; z-index: 0;
            transition: opacity 1s ease-in-out;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            overflow: hidden;
        }
        .chapter.active { opacity: 1; pointer-events: all; z-index: 10; }
        
        /* --- NAVIGATION --- */
        .nav-bar {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 10px; z-index: 50; opacity: 0; transition: opacity 1s;
        }
        .nav-dot {
            width: 8px; height: 8px; background: rgba(255,255,255,0.2); border-radius: 50%;
            transition: all 0.3s;
        }
        .nav-dot.active { background: var(--gold); transform: scale(1.5); }
        
        .next-btn {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            padding: 12px 30px; border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.5); backdrop-filter: blur(10px);
            border-radius: 30px; color: white; font-family: 'Share Tech Mono';
            text-transform: uppercase; letter-spacing: 2px; font-size: 12px;
            cursor: pointer; z-index: 50; opacity: 0; pointer-events: none;
            transition: all 0.3s;
        }
        .next-btn.visible { opacity: 1; pointer-events: all; }
        .next-btn:hover { background: var(--gold); border-color: var(--gold); color: black; }

        /* --- CHAPTER 1: HUD --- */
        .scan-frame { width: 280px; height: 280px; border: 1px solid rgba(0, 243, 255, 0.2); position: relative; }
        .scan-line { position: absolute; width: 100%; height: 2px; background: var(--cyan); box-shadow: 0 0 15px var(--cyan); top: 0; }
        .bracket { position: absolute; width: 20px; height: 20px; border: 2px solid var(--cyan); }
        .tl { top: -1px; left: -1px; border-bottom: 0; border-right: 0; }
        .tr { top: -1px; right: -1px; border-bottom: 0; border-left: 0; }
        .bl { bottom: -1px; left: -1px; border-top: 0; border-right: 0; }
        .br { bottom: -1px; right: -1px; border-top: 0; border-left: 0; }

        /* --- CHAPTER 3: TIME SLIDER --- */
        .slider-wrapper { position: relative; width: 90%; max-width: 500px; aspect-ratio: 4/5; border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        .time-img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
        .time-overlay { position: absolute; inset: 0; clip-path: inset(0 50% 0 0); border-right: 2px solid white; }
        
        /* --- CHAPTER 4: GLOBE --- */
        .globe-container { width: 300px; height: 300px; position: relative; perspective: 1000px; }
        .globe-sphere { width: 100%; height: 100%; border-radius: 50%; background: radial-gradient(circle at 30% 30%, #2b32b2, #000); box-shadow: 0 0 60px rgba(43, 50, 178, 0.4); animation: rotateGlobe 20s linear infinite; position: relative; }
        .map-texture { position: absolute; inset: 0; background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Blue_Marble_2002.png/1024px-Blue_Marble_2002.png'); background-size: cover; opacity: 0.6; border-radius: 50%; }
        @keyframes rotateGlobe { from { transform: rotateY(0deg); } to { transform: rotateY(360deg); } }
        
        /* --- CHAPTER 5: GALLERY --- */
        .gallery-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; padding: 20px; max-width: 600px; height: 60vh; overflow-y: auto; }
        .gallery-item { position: relative; border-radius: 12px; overflow: hidden; aspect-ratio: 3/4; }
        .key { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2rem; opacity: 0.6; animation: float 3s ease-in-out infinite; cursor: pointer; z-index: 20; }
        .key.collected { transform: scale(3); opacity: 0; transition: 0.5s; pointer-events: none; }
        @keyframes float { 0%, 100% { transform: translate(-50%, -50%); } 50% { transform: translate(-50%, -60%); } }

        /* --- CHAPTER 6: VAULT --- */
        .vault-door { width: 120px; height: 120px; border: 4px solid var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: var(--gold); transition: 1s; }
        .scratch-area { position: relative; width: 300px; height: 180px; border-radius: 15px; overflow: hidden; display: none; }
        
        /* UTILS */
        .font-cinematic { font-family: 'Cinzel', serif; }
        .font-tech { font-family: 'Share Tech Mono', monospace; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <audio id="bg-music" loop><source src="https://cdn.pixabay.com/audio/2022/05/27/audio_1808fbf07a.mp3" type="audio/mp3"></audio>
    <audio id="sfx-scan" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>
    <audio id="sfx-success" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>
    
    <button id="mute-btn" class="fixed top-6 right-6 z-[60] text-white/50 hover:text-white"><i class="fas fa-volume-mute text-2xl"></i></button>

    <div class="nav-bar" id="nav-dots">
        <div class="nav-dot active"></div>
        <div class="nav-dot"></div>
        <div class="nav-dot"></div>
        <div class="nav-dot"></div>
        <div class="nav-dot"></div>
        <div class="nav-dot"></div>
    </div>

    <button id="next-chapter-btn" class="next-btn">
        Initialize Chapter <span id="next-chap-num">2</span> <i class="fas fa-chevron-right ml-2"></i>
    </button>

    <div id="chap-1" class="chapter active bg-black">
        <div class="flex flex-col items-center gap-8 relative z-10">
            <div class="scan-frame overflow-hidden bg-black/50">
                <div class="bracket tl"></div><div class="bracket tr"></div><div class="bracket bl"></div><div class="bracket br"></div>
                <img id="id-photo" src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400" 
                     class="w-full h-full object-cover opacity-0 grayscale contrast-125 sepia transition-all duration-700" alt="ID">
                <div class="scan-line"></div>
                <div id="fingerprint" class="absolute inset-0 flex items-center justify-center text-cyan-400 opacity-50"><i class="fas fa-fingerprint text-8xl"></i></div>
            </div>
            
            <div class="text-center font-tech">
                <h2 id="hud-status" class="text-2xl text-cyan-400 tracking-widest mb-2">SYSTEM LOCKED</h2>
                <p class="text-xs text-cyan-400/60">BIOMETRIC AUTHENTICATION REQUIRED</p>
            </div>

            <button onclick="app.startScan()" id="scan-btn" class="px-8 py-3 border border-cyan-400 text-cyan-400 font-tech tracking-[4px] hover:bg-cyan-400 hover:text-black transition-all">
                INITIATE SCAN
            </button>
        </div>
        <div class="absolute inset-0 bg-[linear-gradient(rgba(0,243,255,0.05)_1px,transparent_1px),linear-gradient(90deg,rgba(0,243,255,0.05)_1px,transparent_1px)] bg-[size:40px_40px] pointer-events-none"></div>
    </div>

    <div id="chap-2" class="chapter bg-black">
        <canvas id="star-canvas" class="absolute inset-0 w-full h-full"></canvas>
        <div class="relative z-10 text-center px-6">
            <div class="mb-4 text-xs font-tech text-gray-500 tracking-[0.5em]">TEMPORAL MARKER</div>
            <h2 class="text-6xl md:text-8xl font-cinematic text-white mb-2">JULY 22</h2>
            <div class="h-px w-20 bg-white/30 mx-auto my-6"></div>
            <p class="text-xl font-serif italic text-gray-300">"The night the stars aligned."</p>
        </div>
    </div>

    <div id="chap-3" class="chapter bg-[#080808]">
        <h2 class="text-3xl font-cinematic mb-8">Temporal Shift</h2>
        
        <div class="slider-wrapper">
            <img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=600" class="time-img" alt="Now">
            
            <div id="time-overlay" class="time-overlay">
                <img src="https://images.unsplash.com/photo-1519689680058-324335c77eba?w=600" class="time-img" alt="Baby">
            </div>
        </div>
        
        <input type="range" min="0" max="100" value="50" class="mt-8 w-64 accent-white" oninput="app.updateTime(this.value)">
        <p class="text-xs font-tech text-gray-500 mt-2">DRAG TO TRAVEL</p>
    </div>

    <div id="chap-4" class="chapter bg-[#050505]">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-cinematic text-white mb-2">Global Signal</h2>
            <p class="text-xs font-tech text-cyan-400">INCOMING TRANSMISSIONS</p>
        </div>

        <div class="globe-container">
            <div class="globe-sphere">
                <div class="map-texture"></div>
                <div class="absolute top-[30%] left-[40%] w-4 h-4 bg-red-500 rounded-full animate-ping"></div>
                <div class="absolute top-[50%] left-[70%] w-4 h-4 bg-amber-500 rounded-full animate-ping" style="animation-delay: 0.5s"></div>
            </div>
        </div>

        <div class="flex gap-4 mt-12 overflow-x-auto w-full px-6 no-scrollbar snap-x">
            <div class="min-w-[200px] h-[280px] bg-zinc-900 rounded-xl relative overflow-hidden snap-center shrink-0 border border-white/10" onclick="app.playVideo(this)">
                <img src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=400" class="w-full h-full object-cover opacity-60">
                <div class="absolute bottom-3 left-3 font-bold text-sm">Mom & Dad</div>
                <i class="fas fa-play absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-2xl"></i>
            </div>
            <div class="min-w-[200px] h-[280px] bg-zinc-900 rounded-xl relative overflow-hidden snap-center shrink-0 border border-white/10" onclick="app.playVideo(this)">
                <img src="https://images.unsplash.com/photo-1516975080664-ed2fc6a32937?w=400" class="w-full h-full object-cover opacity-60">
                <div class="absolute bottom-3 left-3 font-bold text-sm">Besties</div>
                <i class="fas fa-play absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-2xl"></i>
            </div>
        </div>
    </div>

    <div id="chap-5" class="chapter bg-[#0a0a0a]">
        <div class="flex justify-between w-full px-8 items-end mb-6">
            <h2 class="text-3xl font-cinematic">Archives</h2>
            <div class="font-tech text-yellow-500 text-sm">KEYS FOUND: <span id="key-count">0</span>/3</div>
        </div>

        <div class="gallery-grid">
            <div class="gallery-item bg-gray-800"><img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400" class="w-full h-full object-cover"></div>
            <div class="gallery-item bg-gray-800">
                <img src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=400" class="w-full h-full object-cover">
                <div class="key" onclick="app.collectKey(this)">ðŸ”‘</div>
            </div>
            <div class="gallery-item bg-gray-800">
                <img src="https://images.unsplash.com/photo-1517841905240-472988babdf9?w=400" class="w-full h-full object-cover">
                <div class="key" style="top:20%; left:80%" onclick="app.collectKey(this)">ðŸ”‘</div>
            </div>
            <div class="gallery-item bg-gray-800"><img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400" class="w-full h-full object-cover"></div>
            <div class="gallery-item bg-gray-800">
                <img src="https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=400" class="w-full h-full object-cover">
                <div class="key" onclick="app.collectKey(this)">ðŸ”‘</div>
            </div>
        </div>
        <p class="text-gray-500 text-xs mt-4 animate-pulse">FIND 3 KEYS TO PROCEED</p>
    </div>

    <div id="chap-6" class="chapter bg-black">
        <div id="vault-locked" class="text-center">
            <div id="vault-icon" class="vault-door mx-auto mb-6"><i class="fas fa-lock"></i></div>
            <h2 class="text-4xl font-cinematic text-gradient">THE VAULT</h2>
            <p class="text-gray-500 text-sm mt-2">SECURE STORAGE</p>
        </div>

        <div id="vault-open" class="hidden flex-col items-center">
            <h2 class="text-3xl font-cinematic text-white mb-6">REWARD UNLOCKED</h2>
            
            <div class="scratch-area bg-white" id="scratch-area">
                <div class="absolute inset-0 flex flex-col items-center justify-center text-center p-4 bg-gradient-to-br from-yellow-100 to-amber-200">
                    <div class="text-xs font-bold text-amber-600 tracking-widest mb-1">HAPPY BIRTHDAY</div>
                    <div class="text-2xl font-bold text-black mb-1">PARIS TRIP</div>
                    <div class="text-[10px] text-gray-700">Flight: AA123 â€¢ July 24</div>
                </div>
                <canvas id="scratch-canvas" class="absolute inset-0 w-full h-full cursor-crosshair"></canvas>
            </div>
            <p class="text-gray-500 text-xs mt-6 font-tech">SCRATCH TO REVEAL</p>
        </div>
        
        <div id="fireworks" class="absolute inset-0 pointer-events-none"></div>
    </div>

    <script>
        const app = {
            currentChapter: 1,
            totalChapters: 6,
            keysFound: 0,
            audioMuted: false,
            
            init: function() {
                this.setupAudio();
                this.setupStars();
                this.setupScratch();
                
                // Nav Button Logic
                document.getElementById('next-chapter-btn').addEventListener('click', () => {
                    this.changeChapter(this.currentChapter + 1);
                });
            },

            // --- NAVIGATION ---
            changeChapter: function(num) {
                // Hide current
                document.getElementById(`chap-${this.currentChapter}`).classList.remove('active');
                document.querySelectorAll('.nav-dot')[this.currentChapter-1].classList.remove('active');
                
                this.currentChapter = num;
                
                // Show next
                document.getElementById(`chap-${num}`).classList.add('active');
                document.querySelectorAll('.nav-dot')[num-1].classList.add('active');
                
                // Reset Button logic
                const btn = document.getElementById('next-chapter-btn');
                btn.classList.remove('visible');
                
                // Specific Chapter Logic
                if(num === 2) {
                    setTimeout(() => this.enableNext(3), 4000); // Auto enable after star animation
                }
                if(num === 3) this.enableNext(4); // Instant enable
                if(num === 4) this.enableNext(5);
                if(num === 6) this.openVault();
            },

            enableNext: function(targetChap) {
                const btn = document.getElementById('next-chapter-btn');
                document.getElementById('next-chap-num').innerText = targetChap;
                btn.classList.add('visible');
            },

            // --- CHAP 1: SCAN ---
            startScan: function() {
                const btn = document.getElementById('scan-btn');
                const line = document.querySelector('.scan-line');
                const photo = document.getElementById('id-photo');
                const fingerprint = document.getElementById('fingerprint');
                const status = document.getElementById('hud-status');
                
                btn.style.opacity = 0;
                document.getElementById('sfx-scan').play();
                
                // Animate Line
                gsap.to(line, { top: '100%', duration: 2, repeat: 1, yoyo: true, ease: "power1.inOut", onComplete: () => {
                    // Success State
                    document.getElementById('sfx-success').play();
                    fingerprint.style.opacity = 0;
                    photo.style.opacity = 1;
                    photo.classList.remove('grayscale', 'sepia');
                    status.innerText = "IDENTITY CONFIRMED";
                    status.style.color = "#0f0";
                    document.querySelector('.scan-frame').style.borderColor = "#0f0";
                    
                    document.getElementById('nav-dots').style.opacity = 1;
                    setTimeout(() => this.enableNext(2), 1000);
                }});
            },

            // --- CHAP 2: STARS ---
            setupStars: function() {
                const canvas = document.getElementById('star-canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth; canvas.height = window.innerHeight;
                const stars = Array(200).fill().map(() => ({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    r: Math.random() * 1.5,
                    a: Math.random()
                }));
                function animate() {
                    ctx.clearRect(0,0,canvas.width, canvas.height);
                    ctx.fillStyle = "white";
                    stars.forEach(s => {
                        ctx.globalAlpha = Math.abs(Math.sin(Date.now()/1000 + s.x));
                        ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fill();
                    });
                    requestAnimationFrame(animate);
                }
                animate();
            },

            // --- CHAP 3: TIME ---
            updateTime: function(val) {
                document.getElementById('time-overlay').style.clipPath = `inset(0 ${100-val}% 0 0)`;
            },

            // --- CHAP 5: KEYS ---
            collectKey: function(el) {
                if(el.classList.contains('collected')) return;
                el.classList.add('collected');
                this.keysFound++;
                document.getElementById('key-count').innerText = this.keysFound;
                
                // Confetti at click position
                const rect = el.getBoundingClientRect();
                confetti({ particleCount: 30, spread: 40, origin: { x: rect.left/window.innerWidth, y: rect.top/window.innerHeight } });

                if(this.keysFound === 3) {
                    setTimeout(() => this.enableNext(6), 1000);
                }
            },

            // --- CHAP 6: VAULT ---
            openVault: function() {
                gsap.to('#vault-icon', { rotate: 360, scale: 0, opacity: 0, duration: 1, delay: 0.5 });
                gsap.to('#vault-locked', { opacity: 0, duration: 0.5, delay: 1, onComplete: () => {
                    document.getElementById('vault-locked').style.display = 'none';
                    document.getElementById('vault-open').classList.remove('hidden');
                    document.getElementById('vault-open').classList.add('flex');
                    document.getElementById('scratch-area').style.display = 'block';
                    this.triggerFireworks();
                }});
            },

            setupScratch: function() {
                const canvas = document.getElementById('scratch-canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 300; canvas.height = 180;
                
                ctx.fillStyle = "#C0C0C0";
                ctx.fillRect(0,0,300,180);
                ctx.fillStyle = "#000";
                ctx.font = "16px Arial";
                ctx.fillText("SCRATCH HERE", 90, 95);

                let isDrawing = false;
                const scratch = (e) => {
                    if(!isDrawing) return;
                    e.preventDefault();
                    const rect = canvas.getBoundingClientRect();
                    const x = (e.clientX || e.touches[0].clientX) - rect.left;
                    const y = (e.clientY || e.touches[0].clientY) - rect.top;
                    ctx.globalCompositeOperation = "destination-out";
                    ctx.beginPath(); ctx.arc(x,y,20,0,Math.PI*2); ctx.fill();
                }

                canvas.addEventListener('mousedown', () => isDrawing = true);
                canvas.addEventListener('touchstart', () => isDrawing = true);
                window.addEventListener('mouseup', () => isDrawing = false);
                window.addEventListener('touchend', () => isDrawing = false);
                canvas.addEventListener('mousemove', scratch);
                canvas.addEventListener('touchmove', scratch);
            },

            triggerFireworks: function() {
                const duration = 3000;
                const end = Date.now() + duration;
                (function frame() {
                    confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 } });
                    confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 } });
                    if (Date.now() < end) requestAnimationFrame(frame);
                }());
            },

            setupAudio: function() {
                const btn = document.getElementById('mute-btn');
                const music = document.getElementById('bg-music');
                music.volume = 0.3;
                
                btn.addEventListener('click', () => {
                    this.audioMuted = !this.audioMuted;
                    music.muted = this.audioMuted;
                    btn.innerHTML = this.audioMuted ? '<i class="fas fa-volume-off text-2xl"></i>' : '<i class="fas fa-volume-up text-2xl"></i>';
                    if(!this.audioMuted) music.play().catch(()=>{});
                });
                
                // Auto play on first interaction
                document.body.addEventListener('click', () => {
                    if(!this.audioMuted) music.play().catch(()=>{});
                }, { once: true });
            },
            
            playVideo: function(el) {
                // Placeholder for video logic
                alert("Video playing...");
            }
        };

        window.onload = () => app.init();
    </script>
</body>
</html>
